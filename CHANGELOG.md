# 更新日志

## v0.1.18 - 2025-10-29

### 🔧 功能改进
- **版本替换配置保存修复**: 解决配置保存无作用问题，简化配置保存逻辑只保存到项目根目录
- **配置加载优化**: 改进配置加载机制，确保从正确位置加载配置文件
- **自动保存增强**: 完善自动保存功能，提供更好的保存状态反馈
- **UI布局优化**: 减小路径配置区域高度，让执行日志占满剩余高度
- **执行日志样式统一**: 调整执行日志的字体和样式，与系统日志保持完全一致

### 🐛 问题修复
- **配置文件路径不一致**: 修复配置保存到多个位置导致的混乱问题
- **配置加载失败**: 解决配置文件无法正确加载的问题
- **UI空间分配不合理**: 修复路径配置区域占用过多空间的问题
- **日志样式差异**: 统一执行日志与系统日志的显示样式

### 📋 技术细节
- **配置管理重构**: 简化配置保存和加载逻辑，移除多位置保存复杂性
- **布局策略优化**: 使用QSizePolicy和分隔器比例优化空间分配
- **字体样式统一**: 执行日志使用与系统日志相同的Consolas字体和大小
- **错误处理增强**: 改进配置操作的错误处理和用户反馈

### 📁 修改文件
- `core/version.json`: 版本号递增到v0.1.18
- `config/version_replace_config.json`: 创建示例配置文件
- `ui/main_window/enhanced_version_replacer_widget.py`: 配置保存修复和UI优化
- `docs/sj.md`: 版本发布流程文档

---

## v0.1.17 - 2025-10-28

### 🚀 新增功能
- **进度弹窗系统**: 为WIM挂载和卸载操作添加美观的进度弹窗界面，替代原有的简单进度条
- **MakeWinPEMedia统一模块**: 创建统一的MakeWinPEMedia管理模块，整合所有ISO、WIM和USB制作功能
- **系统日志标签优化**: 将所有系统日志标签（如[进度]、[成功]、[失败]等）移动到消息末尾，提升可读性
- **UI标签顺序优化**: 调整主窗口标签顺序为：基础配置、定制选项、开始构建、版本替换、系统日志

### 🔧 功能改进
- **WIM操作用户体验**: 挂载和卸载操作现在显示详细进度信息、实时日志和可取消功能
- **MakeWinPEMedia集成**: 所有ISO创建操作统一使用MakeWinPEMedia模块，替代oscdimg命令
- **进度回调机制**: 实现基于文件计数和分阶段的真实进度估算，而非模拟进度
- **错误处理增强**: 完善的异常处理和回退机制，确保系统稳定性

### 🐛 问题修复
- **进度弹窗显示修复**: 解决WIM挂载/卸载只显示终端输出而无弹窗的问题
- **重复函数冲突**: 修复wim_operations_common中方法名不符实的问题
- **导入冲突解决**: 解决新旧WIM操作线程的导入冲突和参数不匹配问题
- **MakeWinPEMedia路径检测**: 修复MakeWinPEMedia工具在新版ADK中的路径检测问题

### 📋 技术细节
- **进度对话框架构**: 基于PyQt5的模态对话框，支持实时进度条、日志区域和取消操作
- **多线程安全**: 所有长时间操作都在后台线程中执行，避免UI阻塞
- **信号槽机制**: 使用PyQt5信号槽实现线程间通信和进度更新
- **统一接口**: MakeWinPEMedia管理器提供统一的API接口，简化上层调用

### 🔄 兼容性
- 保持原有API接口不变，确保现有代码无需修改
- 支持新旧ADK版本，自动检测并使用正确的MakeWinPEMedia路径
- 向后兼容所有现有的WIM操作功能

---

## v0.1.16 - 2025-10-28

### 🚀 新增功能
- **一键制作ISO功能**: 在配置和分析标签页添加一键制作ISO按钮，支持先版本替换再制作ISO的完整流程
- **智能检测机制**: 自动检测版本替换状态，如需要则先执行版本替换操作
- **多标签页支持**: 在配置、分析和执行标签页都有一键制作ISO功能

### 🔧 功能改进
- **WIM操作统一化**: 版本替换器优先使用统一WIM管理器接口，提升代码一致性
- **进度显示完善**: 修复ISO创建成功后进度条未达到100%的问题
- **用户体验优化**: 统一按钮样式，自动切换到执行标签页显示进度

### 🐛 问题修复
- **ISO创建PowerShell调用修复**: 修复osc dimg命令中引号嵌套导致的执行失败问题
- **WinPE启动路径配置修复**: 解决WinPE启动时"X:\windows"与"X:\$windows.~bt\Windows"路径不一致问题
- **WIM挂载卸载优化**: 增强WIM操作的错误处理和回退机制

### 📋 技术细节
- 使用DISM命令修复WinPE SYSTEMROOT路径配置
- 创建WinPE启动配置文件确保正确启动
- 优化PowerShell命令构建逻辑避免参数冲突
- 增强版本替换器的路径处理和验证功能

### 📁 修改文件
- `core/version.json`: 版本号递增到v0.1.16
- `core/adk_manager.py`: ISO创建PowerShell调用修复
- `core/version_replacer.py`: WIM操作统一化、路径修复增强
- `core/version_replacer/enhanced_replacer.py`: 新增路径修复功能
- `ui/main_window/enhanced_version_replacer_widget.py`: 一键ISO按钮、进度修复
- `docs/sj.md`: 技术修复记录文档

---

## v0.1.15 - 2025-10-27

### 🔧 功能改进
- 统一WIM管理系统完全重构
- 增强日志系统和错误处理
- 优化版本替换工作流程

### 🐛 问题修复
- 修复WIM操作线程安全问题
- 解决WIM挂载状态检测问题
- 修复构建进度显示异常

---

## v0.1.14 - 2025-10-26

### 🚀 新增功能
- 统一WIM操作系统和挂载进度条
- 增强版WinPE版本替换系统
- 智能组件分析和迁移功能

### 🔧 功能改进
- 重构WIM管理模块化架构
- 改进错误诊断和恢复机制
- 优化构建日志和状态跟踪

### 🐛 问题修复
- 修复WIM文件大小显示问题
- 解决挂载目录权限问题
- 修复构建中断后的清理问题

---

*更多历史版本请查看项目文档*